<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MusicApp</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/home.css') }}"
    />
  </head>
  <body>
    <div class="app">
      <header>
        <div class="brand">
          <div class="logo">M</div>
          <div>
            <div style="font-weight: 700">MusicApp</div>
            <div style="font-size: 12px; color: var(--muted)">
              Sua m√∫sica, sempre
            </div>
          </div>
        </div>

        <form class="search" role="search" id="search-form" style="display: flex; align-items: center; gap: 8px">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            aria-hidden
          >
            <path
              d="M21 21l-4.35-4.35"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          <input
            type="search"
            id="search-input"
            placeholder="Buscar m√∫sicas, artistas, playlists..."
            aria-label="Buscar"
          />
        </form>

        <div class="user">
        </div>
      </header>

      <main>
        <section class="hero">
          <div class="hero-card">
            <img src="https://picsum.photos/200/200?random=1" alt="Capa" />
            <div class="meta">
              <h2>Sua Playlist</h2>
              <p id="playlist-info">
                {{ playlist|length }} m√∫sicas na fila
              </p>
            </div>
          </div>
        </section>

        <section>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px">
            <h3 style="margin: 0">Fila de Reprodu√ß√£o (<span id="queue-count">{{ playlist|length }}</span>)</h3>
            <button style="background: var(--accent); border: 0; padding: 8px 16px; border-radius: 6px; color: #000; font-weight: 600; cursor: pointer">‚ñ∂ Reproduzir</button>
          </div>

          <div id="queue-container" style="display: flex; flex-direction: column; gap: 8px">
            {% for musica in playlist %}
            <div
              class="playlist-track"
              data-musica-id="{{ loop.index0 }}"
              style="
                display: flex;
                align-items: center;
                padding: 12px;
                background: var(--card);
                border-radius: 8px;
                cursor: pointer;
                transition: background 0.2s;
              "
            >
              <div
                style="
                  width: 24px;
                  text-align: center;
                  color: var(--muted);
                  font-size: 14px;
                  margin-right: 12px;
                "
              >
                {{ loop.index }}
              </div>
              <img
                src="https://picsum.photos/60/60?random={{ loop.index }}"
                alt="{{ musica.nome }}"
                style="
                  width: 60px;
                  height: 60px;
                  border-radius: 6px;
                  margin-right: 16px;
                "
              />
              <div style="flex: 1">
                <div style="font-weight: 600; margin-bottom: 4px">
                  {{ musica.nome }}
                </div>
                <div style="color: var(--muted); font-size: 13px">
                  {{ musica.cantor }} ‚Ä¢ {{ musica.genero }}
                </div>
              </div>
              <div
                style="color: var(--muted); font-size: 13px; margin-right: 16px"
              >
                {{ musica.duracao }}
              </div>
            </div>
            {% endfor %}
          </div>
        </section>
      </main>

      <aside class="recommendations" aria-label="M√∫sicas Recomendadas">
        <div class="queue-header">
          <strong>Recomendadas</strong>
          <small style="color: var(--muted)"
            >{{ recomendadas|length }} m√∫sicas</small
          >
        </div>
        <div class="queue-list" style="max-height: 100%; overflow-y: auto;">
          {% for musica in recomendadas %}
          <div
            class="track"
            style="
              padding: 8px;
              border-radius: 6px;
              cursor: pointer;
              transition: background 0.2s;
            "
            onmouseover="this.style.background='var(--glass)'"
            onmouseout="this.style.background='transparent'"
          >
            <img
              src="https://picsum.photos/48/48?random={{ loop.index + 10 }}"
              alt="{{ musica.nome }}"
            />
            <div class="info">
              <div class="t">{{ musica.nome }}</div>
              <div class="a">{{ musica.cantor }}</div>
            </div>
            <button 
              class="add-btn"
              data-musica-id="{{ loop.index0 + 10 }}"
              style="background: transparent; border: 0; color: var(--accent); cursor: pointer; padding: 4px; font-size: 16px; text-decoration: none; font-weight: 700"
              title="Adicionar √† fila"
            >
              +
            </button>
          </div>
          {% endfor %}
        </div>
      </aside>
    </div>

    <div class="mini-player" aria-hidden="false">
      <img
        class="cover"
        src="https://picsum.photos/56/56?random=1"
        alt="{{ playlist[0].nome if playlist else 'Nenhuma m√∫sica' }}"
      />
      <div class="controls">
        <div class="title">
          {{ playlist[0].nome if playlist else 'Nenhuma m√∫sica tocando' }} ‚Äî {{
          playlist[0].cantor if playlist else '' }}
        </div>
        <div
          style="display: flex; gap: 8px; margin-top: 6px; align-items: center"
        >
          <button
            id="back-btn"
            style="
              background: transparent;
              border: 0;
              color: var(--muted);
              cursor: pointer;
            "
            title="M√∫sica anterior"
          >
            ‚èÆ
          </button>
          <button
            style="
              background: var(--accent);
              border: 0;
              padding: 8px 12px;
              border-radius: 50%;
              color: #000;
              font-weight: 700;
              cursor: pointer;
            "
          >
            ‚è∏
          </button>
          <button
            id="skip-btn"
            style="
              background: transparent;
              border: 0;
              color: var(--muted);
              cursor: pointer;
            "
            title="Pr√≥xima m√∫sica"
          >
            ‚è≠
          </button>
          <button
            style="
              background: transparent;
              border: 0;
              color: var(--muted);
              cursor: pointer;
              margin-left: 8px;
            "
          >
            üîÄ
          </button>
        </div>
        <div class="progress" aria-hidden="true">
          <i style="width: 35%"></i>
        </div>
      </div>
    </div>

    <script>
      // Buscar m√∫sica via Hash Table
      document.getElementById('search-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const termo = document.getElementById('search-input').value.trim();
        
        if (termo.length > 0) {
          try {
            const response = await fetch(`/buscar/${encodeURIComponent(termo)}`);
            if (response.ok) {
              location.reload();
            }
          } catch (error) {
            console.error('Erro ao buscar m√∫sica:', error);
          }
        }
      });

      // Voltar para m√∫sica anterior
      document.getElementById('back-btn').addEventListener('click', async (e) => {
        e.preventDefault();
        try {
          const response = await fetch('/voltar', { method: 'POST' });
          if (response.ok) {
            location.reload();
          }
        } catch (error) {
          console.error('Erro ao voltar m√∫sica:', error);
        }
      });

      // Pular m√∫sica
      document.getElementById('skip-btn').addEventListener('click', async (e) => {
        e.preventDefault();
        try {
          const response = await fetch('/pular', { method: 'POST' });
          if (response.ok) {
            location.reload();
          }
        } catch (error) {
          console.error('Erro ao pular m√∫sica:', error);
        }
      });

      // Adicionar m√∫sica √† fila
      document.querySelectorAll('.add-btn').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          e.preventDefault();
          const musicaId = btn.getAttribute('data-musica-id');
          
          try {
            const response = await fetch(`/adicionar/${musicaId}`);
            if (response.ok) {
              location.reload();
            }
          } catch (error) {
            console.error('Erro ao adicionar m√∫sica:', error);
          }
        });
      });
    </script>
  </body>
</html>
